@page "/"
@rendermode InteractiveServer
@inject UsuarioLoginUseCase UsuarioLoginUseCase
@inject NavigationManager NavigationManager
@inject Sesion Sesion
<PageTitle></PageTitle>

<h3>Iniciar Sesión</h3>

<div class="card p-4 shadow" style="max-width: 400px;">
    
    <div class="form-group">
        @if (!string.IsNullOrEmpty(_error))
        {
            <div class="alert alert-danger">@_error</div>
        }
        
        @if (_exito)
        {
            <div class="alert alert-success">@_exito</div>
        }
        <label for="username">Usuario</label>
        <input @bind="_email" class="form-control" id="email" placeholder="Ingrese su usuario" />
    </div>

    <div class="form-group mt-3">
        <label for="password">Contraseña</label>
        <input @bind="_password" type="password" class="form-control" id="password" placeholder="Ingrese su contraseña" />
    </div>

    <div class="mt-4">
        <button class="btn btn-primary w-100" @onclick="IniciarSesion">Ingresar</button>
    </div>

    <div class="mt-2 text-center">
        <a href="/crearusuario">Crear usuario</a>
    </div>
</div>

@code {
    private string _email = "";
    private string _password = "";
    private bool _exito;
    private string _error = "";
    public void IniciarSesion()
    {
        var resultado = UsuarioLoginUseCase.Ejecutar(_email, _password);
        if (resultado.Exitoso)
        {
            Sesion.Iniciar(resultado.Usuario!);
            _exito = true;
            NavigationManager.NavigateTo("/home");
        }
        else
        {
            Console.WriteLine("Error al iniciar sesión: " + resultado.Error);
            _error = resultado.Error!;
        }
    }
}